# Code Generators - ELI5 (Explain Like I'm 5) ğŸ§¸

## What Does This Do? ğŸ¤”

Imagine you have toy boxes (your app) with lots of different toys (models and tools). Every time you want to play, you need to find all the toys. 

**The Old Way (Slow):** 
Every time the app starts, it looks through the entire toy box to find all the toys. This takes time! â°

**The New Way (Fast):**
Before you even start playing, we make a list of where all the toys are! Now when you want to play, you just read the list instead of searching. Much faster! ğŸš€

## What Generators Are Available? ğŸ­

We have TWO generators:

### 1. Model Imports Generator ğŸ“Š
**What it does:** Finds all database model classes (like Empresa, Sensor, etc.)
**Where it looks:** `src/database/models/`
**What it creates:** `src/database/generated_models_imports.py`

### 2. Tool Imports Generator ğŸ› ï¸
**What it does:** Finds all LLM tool classes (like DateTimeTool, ListarEquipamentosTool, etc.)
**Where it looks:** `src/large_language_model/tools/`
**What it creates:** `src/large_language_model/generated_tools_imports.py`

## What is a "Generator"? ğŸ­

A generator is like a helper robot ğŸ¤– that:
1. Looks at all your toy boxes (model/tool files)
2. Finds which ones have the toys you need (Model/BaseTool classes)
3. Makes a list of them (generates a file)

This list is saved, so next time you don't need to search again!

## How to Run the Generators ğŸƒâ€â™‚ï¸

### Option 1: Run them manually (for testing)

```bash
# From the project root directory

# Generate model imports
python generators/generate_model_imports.py

# Generate tool imports
python generators/generate_tool_imports.py
```

You'll see something like:
```
Static Model Imports Generator
==================================================
Project root: /your/project/path
Models directory: /your/project/path/src/database/models
Output file: /your/project/path/src/database/generated_models_imports.py

âœ“ Generated /your/project/path/src/database/generated_models_imports.py
  - Found 4 module(s) with Model subclasses
    â€¢ src.database.models.empresa
    â€¢ src.database.models.equipamento
    â€¢ src.database.models.manutencao_equipamento
    â€¢ src.database.models.sensor

âœ“ Generation complete!
```

### Option 2: They run automatically! âœ¨

When you build the Docker image, the generators run **automatically**! 

Look in the Dockerfile:
```dockerfile
COPY generators/generate_model_imports.py /app/generators/generate_model_imports.py
COPY generators/generate_tool_imports.py /app/generators/generate_tool_imports.py
RUN python /app/generators/generate_model_imports.py
RUN python /app/generators/generate_tool_imports.py
```

This means:
- Every time you build the app â†’ generators run
- The lists are always up-to-date
- Your app starts faster! 

## What Files Are Involved? ğŸ“

### For Models:
**Input:** `src/database/models/*.py` - All your model files
**Generator:** `generators/generate_model_imports.py` - The generator script
**Output:** `src/database/generated_models_imports.py` - The generated list

### For Tools:
**Input:** `src/large_language_model/tools/*.py` - All your tool files
**Generator:** `generators/generate_tool_imports.py` - The generator script
**Output:** `src/large_language_model/generated_tools_imports.py` - The generated list

## How Does It Work? ğŸ”

1. **Scan**: The generator looks at every `.py` file in the target directory
2. **Detect**: It checks if the file has a class that inherits from the base class (Model or BaseTool)
   - It does this using AST (Abstract Syntax Tree) - like reading the code without running it
3. **Generate**: It creates a new file with import statements for all classes found
4. **Save**: The file is saved as `generated_*_imports.py`

## Example of What Gets Generated ğŸ“

### For Models

If you have these model files:
- `empresa.py` (has `class Empresa(Model)`)
- `sensor.py` (has `class Sensor(Model)`)
- `utils.py` (just helper functions, no Model)

The generator creates:
```python
# AUTOGENERATED FILE - DO NOT EDIT
# Generated by generators/generate_model_imports.py

import importlib
import logging

logger = logging.getLogger(__name__)

def import_generated_models() -> None:
    """Import all modules that contain Model subclasses."""
    # Importing 2 model module(s)
    try:
        importlib.import_module("src.database.models.empresa")
    except ImportError as e:
        logger.error(f"Failed to import src.database.models.empresa: {e}")
    try:
        importlib.import_module("src.database.models.sensor")
    except ImportError as e:
        logger.error(f"Failed to import src.database.models.sensor: {e}")
```

Notice that `utils.py` is NOT included because it doesn't have a Model class!

### For Tools

If you have these tool files:
- `datetime_tool.py` (has `class DateTimeTool(BaseTool)`)
- `listar_equipamentos_tool.py` (has `class ListarEquipamentosTool(BaseTool)`)
- `helpers.py` (just helper functions, no BaseTool)

The generator creates:
```python
# AUTOGENERATED FILE - DO NOT EDIT
# Generated by generators/generate_tool_imports.py

import importlib
import logging

logger = logging.getLogger(__name__)

def import_generated_tools() -> None:
    """Import all modules that contain BaseTool subclasses."""
    # Importing 2 tool module(s)
    try:
        importlib.import_module("src.large_language_model.tools.datetime_tool")
    except ImportError as e:
        logger.error(f"Failed to import src.large_language_model.tools.datetime_tool: {e}")
    try:
        importlib.import_module("src.large_language_model.tools.listar_equipamentos_tool")
    except ImportError as e:
        logger.error(f"Failed to import src.large_language_model.tools.listar_equipamentos_tool: {e}")
```

## When Should I Run It? â°

**You usually don't need to!** Generators run automatically during Docker build.

But you might want to run them manually if:
- âœ… You added a new model/tool and want to test it works
- âœ… You're debugging import issues
- âœ… You want to see what models/tools will be imported

## Troubleshooting ğŸ”§

### "No models/tools found!"
- Check that your files are in the correct directory
- Make sure your classes inherit from the correct base class (Model or BaseTool)
- Check for syntax errors in your files

### "Import failed!"
- Check that the generated file exists
- Try running the generator manually to see errors
- Check the logs for specific import errors

### "Generator won't run!"
- Make sure you're in the project root directory
- Check that Python can find the `src` package
- Try: `python -c "import sys; sys.path.insert(0, '.'); from generators.generate_model_imports import *"`

## What's the Magic? âœ¨

The "magic" is that instead of finding models/tools every single time your app starts (slow), we find them once when building the Docker image (fast)!

Think of it like:
- **Old way**: Look through the whole library every time you want a book ğŸ“šğŸ˜°
- **New way**: Use the library catalog that lists all books ğŸ“–ğŸ˜Š

## Fallback Mechanism ğŸ›¡ï¸

Both `import_models()` and `import_tools()` functions have a fallback mechanism:

1. **First attempt**: Try to use the generated static imports (fast)
2. **If it fails**: Fall back to dynamic imports at runtime (slower but still works)

This means your app will work even if:
- The generators didn't run
- The generated files are missing
- You're running in development mode

## Where to Learn More? ğŸ“š

- Read the code: 
  - `generators/generate_model_imports.py` (for models)
  - `generators/generate_tool_imports.py` (for tools)
- Check the usage:
  - `src/database/dynamic_import.py` (models import logic)
  - `src/large_language_model/dynamic_tools.py` (tools import logic)
- Look at what gets created: 
  - `src/database/generated_models_imports.py`
  - `src/large_language_model/generated_tools_imports.py`

---

**Made with â¤ï¸ to make your app start faster!**
